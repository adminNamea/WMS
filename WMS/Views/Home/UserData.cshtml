
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>UserData</title>
</head>
<body>
    <blockquote class="layui-elem-quote">用户信息</blockquote>
    <form class="layui-form layui-form-pane" id="userEditForm" style="padding-left:100px;">
        <input class="layui-hide" name="id">
        <div class="layui-form-item">
            <label class="layui-form-label">用户名</label>
            <div class="layui-input-inline">
                <input type="text" name="UserName" required lay-verify="required|username" placeholder="请输入用户名" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">密码</label>
            <div class="layui-input-inline">
                <input type="text" name="PWD" required lay-verify="required|pass" placeholder="请输入密码" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">姓名</label>
            <div class="layui-input-inline">
                <input type="text" name="EmployeeName" required lay-verify="required" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">电话</label>
            <div class="layui-input-inline">
                <input type="text" name="Tel" required lay-verify="required|number|phone" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item" style="padding-left:20px">
            <div class="layui-input-inline">
                <button class="layui-btn" lay-submit lay-filter="formDemo">更新</button>
            </div>
            <div class="layui-input-inline">
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
    <script>
        layui.use(['form', 'layer','element'], function () {
            var form = layui.form, layer = layui.layer, element = layui.element;
            var $ = layui.jquery
            var bool = false;
            $.get("/Home/checkUser", { value: '@Session["user"]' }, function (data) {
                $("[name=id]").val(data[0].ID)
                $("[name=UserName]").val(data[0].UserName)
                $("[name=PWD]").val(data[0].PWD)
                $("[name=EmployeeName]").val(data[0].EmployeeName)
                $("[name=Tel]").val(data[0].Tel)
            })
            form.on('switch', function (data) {
                WCS = data.elem.checked
            });
            $("[name=UserName]").keyup(function () {
                var value = $(this).val().trim();
                $.get("/Home/checkUser", { value: value }, function (data) {
                    if (data.length == 0) {
                        bool = true;
                    } else {
                        bool = false;
                    }
                })
            })
            form.on('submit(formDemo)', function (data) {
                if (bool) {
                    layer.confirm('更新将重新登陆确定更新?', { icon: 3, title: '提示' }, function (index) {
                        $.post("/Home/AddUser", { User: data.field, type: "up" }, function (data) {
                            if (data == "true") {
                                $.get("/Home/OutUser", function (data) {
                                    if (data == "true") {
                                        $(".userName").text("未登录")
                                        $('.log').replaceWith("<li lay-id=11 class='log'>WMS-基础资料-员工登陆</li><i>/WMS/login</i>")
                                        element.render();
                                        element.tabChange('docDemoTabBrief', 11);
                                        layer.close(index);
                                    }
                                })
                            }
                        })
                    });
                } else {
                    layer.msg('用户名重复', { icon: 5 })
                }
                return false;
            })
            form.verify({
                username: function (value, item) {
                    if (!new RegExp("^[a-zA-Z0-9_\u4e00-\u9fa5\\s·]+$").test(value)) {
                        return '用户名不能有特殊字符';
                    }
                    if (/(^\_)|(\__)|(\_+$)/.test(value)) {
                        return '用户名首尾不能出现下划线\'_\'';
                    }
                    if (/^\d+\d+\d$/.test(value)) {
                        return '用户名不能全为数字';
                    }
                }
                , pass: [
                    /^[\S]{6,12}$/
                    , '密码必须6到12位，且不能出现空格'
                ]
            });
        });
    </script>
</body>
</html>
